<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cytoscape.js JSON Upload Example with Layout Switch and Custom Styling</title>
	<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
	<script src="https://unpkg.com/webcola@3.4.0/WebCola/cola.js"></script>
	<script src="https://unpkg.com/cytoscape-cola"></script>
	<script src="https://unpkg.com/klayjs@0.4.1/klay.js"></script>
	<script src="https://unpkg.com/cytoscape-klay@3.1.4/cytoscape-klay.js"></script>
	<script src="https://unpkg.com/cytoscape-euler@1.2.2/cytoscape-euler.js"></script>
	<style>
		#cy {
			width: 100%;
			height: 600px;
			border: 1px solid #ddd;
		}
	</style>
</head>

<body>

	<h1>Upload Cytoscape JSON File</h1>
	<input type="file" id="fileInput" accept=".json">
	<button id="useEuler">Use Euler Layout</button>
	<button id="useCola">Use Cola Layout</button>
	<button id="useKlay">Use Klay Layout</button>
	<div id="cy"></div>

	<script>
		let cy;

		document.getElementById('fileInput').addEventListener('change', function (event) {
			const file = event.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function (e) {
					const json = JSON.parse(e.target.result);
					renderCytoscapeGraph(json, 'cola');
				};
				reader.readAsText(file);
			}
		});

		document.getElementById('useEuler').addEventListener('click', function () {
			if (cy) {
				cy.layout({
					name: 'euler',
					animate: true
				}).run();
			}
		});

		document.getElementById('useCola').addEventListener('click', function () {
			if (cy) {
				cy.layout({
					name: 'cola',
					nodeSpacing: 10,
					edgeLengthVal: 45,
					animate: true,
					randomize: false,
					maxSimulationTime: 1500
				}).run();
			}
		});

		document.getElementById('useKlay').addEventListener('click', function () {
			if (cy) {
				cy.layout({
					name: 'klay',
					nodeDimensionsIncludeLabels: true,
					fit: true,
					padding: 20,
					animate: false,
					klay: {
						addUnnecessaryBendpoints: false,
						direction: 'DOWN',
						edgeRouting: 'ORTHOGONAL',
						thoroughness: 30
					}
				}).run();
			}
		});

		function hashStringToHue(str) {
			let hash = 0;
			for (let i = 0; i < str.length; i++) {
				hash = str.charCodeAt(i) + ((hash << 4) - hash);
			}
			return (Math.abs(hash) % 18) * 20;
		}

		function renderCytoscapeGraph(json, layoutName) {
			cy = cytoscape({
				container: document.getElementById('cy'),
				elements: json.elements,
				style: [
					{
						selector: 'node',
						style: {
							'background-color': ele => {
								const labels = ele.data('labels') || [];
								const labelStr = labels.join('-');
								const hue = hashStringToHue(labelStr);
								return `hsl(${hue}, 90%, 60%)`;
							},
							'label': 'data(id)'
						}
					},
					{
						selector: 'edge',
						style: {
							'width': 3,
							'line-fill': 'linear-gradient',
							'line-gradient-stop-colors': '#ccc #000',
							'line-gradient-stop-positions': '0% 100%',
							'label': 'data(label)',
							'font-size': 10,
							'text-background-opacity': 1,
							'text-background-color': '#fff',
							'text-background-shape': 'roundrectangle',
							'text-margin-y': -10
						}
					}
				],
				layout: {
					name: layoutName,
					animate: true
				}
			});
		}
	</script>

</body>

</html>